# Deep Q Network

This branch is part of the AI Thermostat repository and implements a DQN model rather than imitation learning
The components are largely the same, but there are some key differences

## Training

`train_rl` trains and generates a model either from scratch or from an existing one, to train from an existing one,
use `-m dir/to/model.pt` to continue training from a previously generated model
To control the name of the output generated by `train_rl` use `-o dir/to/model.pt` to generate the resulting model as `x.pt`
By default, the model will save every 100 episodes, as well as when you press `ctrl + c` to prevent loss of the model after a disruption in training
To add a custom saving point, use `-s [integer]` and it will save once after that many episodes

Example input: 

``` 
python train_rl.py -m better.pt_episode_1000.pt -o new.pt -s 50 1000
```

## Optuna
Optuna is a library that runs tests on your training agent to find the best hyperparameters. It runs a user-set number of trials on a user-set number of episodes. To change the number of trials to run, use `--trials [integer]`; to change the number of episodes each trial runs on, use `--episodes [integer]`. **Optuna uses the same simulation as train_rl, except it cycles the hyperparameters, so it may not work at a low number of episodes.**

Example input:

```
python optimize.py --trials 50 --episodes 1000
```

## Gen Data

`gen_data2_rl` generates a list of box plots with data produced by the selected model after each run.
In `gen_data2_rl`, `-m dir/to/model.pt` will run any `x.pt` model generated by `train_rl`.
To control the output image of the simulation use `-o dir/to/output.png` and it will generate the image as that file. 
You must also enter the number of episodes (days) to generate as a command line argument.

Example input:

``` 
python gen_data2_rl.py -m better.pt_episode_1000.pt -o out.png 1000
```

## Sim / Time Series

These will generate a time series of the state of the house. 
The bottom box represents if the setting of the AC (-1 = max cool, 0 = off, 1 = max heat). 
Each box represents a room. The green line is the same in each plot and represents outside temperature. 
Red line is current room temperature and blue line is the setpoint (target). 
Command line arguments mean the same as in Gen Data. 
A new command line argument can be passed, `-t [integer]` which tells the program how many minutes to simulate. 
Default is 1440 or 1 day.

Example input:

``` 
python sim2_rl.py -m better.pt_episode_1000.pt -o out.png -t 1440
```

## Install
It is known that this branch works on macOS with Python 3.12* 

Full list of dependencies:

```
pip install matplotlib optuna numpy gymnasium torch
```
